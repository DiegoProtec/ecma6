{"version":3,"sources":["../../app-es6/controllers/NegociacaoController.js"],"names":["Mensagem","Negociacao","Negociacoes","MensagemView","NegociacoesView","NegociacaoService","DateHelper","Bind","NegociacaoController","$","document","querySelector","bind","_data","_quantidade","_valor","_negociacoes","_mensagem","_ordemAtual","_init","listar","then","negociacoes","forEach","adiciona","negociacao","catch","texto","erro","setInterval","importa","importar","cadastrar","console","log","mensagem","event","preventDefault","_criaNegociacao","_limpaForm","apagar","limpa","paraData","value","parseInt","parseFloat","focus","coluna","inverteOrdem","ordena","p","s","negociacaoController","currentInstance"],"mappings":"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","file":"NegociacaoController.js","sourcesContent":["import { Mensagem } from '../models/Mensagem';\nimport { Negociacao } from '../models/Negociacao';\nimport { Negociacoes } from '../models/Negociacoes';\nimport { MensagemView } from '../views/MensagemView';\nimport { NegociacoesView } from '../views/NegociacoesView';\nimport { NegociacaoService } from '../services/NegociacaoService';\nimport { DateHelper } from '../helpers/DateHelper';\nimport { Bind } from '../helpers/Bind';\n\nclass NegociacaoController {\n\n    constructor() {\n        let $ = document.querySelector.bind(document);\n\n        this._data = $('#data');\n        this._quantidade = $('#quantidade');\n        this._valor = $('#valor');\n\n        this._negociacoes = new Bind(\n            new Negociacoes(),\n            new NegociacoesView($('#tableNegociacoes')),\n            'adiciona', 'limpa', 'ordena', 'inverteOrdem');\n\n        this._mensagem = new Bind(\n            new Mensagem(),\n            new MensagemView($('#mensagem')),\n            'texto');\n\n        this._ordemAtual = '';\n        this._init();\n    }\n\n    _init() {\n\n        new NegociacaoService()\n            .listar()\n            .then(negociacoes =>\n                negociacoes.forEach(negociacao =>\n                    this._negociacoes.adiciona(negociacao)))\n            .catch(erro => this._mensagem.texto = erro);\n\n        setInterval(() => this.importa(), 3000);\n    }\n\n    importa() {\n\n        new NegociacaoService()\n            .importar(this._negociacoes._negociacoes)\n            .then(negociacoes => {\n                negociacoes.forEach(negociacao => {\n                    this._negociacoes.adiciona(negociacao);\n                    new NegociacaoService()\n                        .cadastrar(negociacao)\n                        .then(mensagem => console.log(mensagem));\n                });\n                this._mensagem.texto = 'Negociações do período importadas e cadastradas';\n            })\n            .catch(erro => this._mensagem.texto = erro);\n    }\n\n    adiciona(event) {\n\n        event.preventDefault();\n        let negociacao = this._criaNegociacao();\n        new NegociacaoService()\n            .cadastrar(negociacao)\n            .then(mensagem => {\n                this._negociacoes.adiciona(negociacao);\n                this._mensagem.texto = mensagem;\n                this._limpaForm();\n            })\n            .catch(erro => this._mensagem.texto = erro);\n    }\n\n    apaga() {\n\n        new NegociacaoService()\n            .apagar()\n            .then(mensagem => {\n                this._negociacoes.limpa();\n                this._mensagem.texto = mensagem;\n            })\n            .catch(erro => this._mensagem.texto = erro);\n    }\n\n    _criaNegociacao() {\n        return new Negociacao(\n            DateHelper.paraData(this._data.value),\n            parseInt(this._quantidade.value),\n            parseFloat(this._valor.value));\n    }\n\n    _limpaForm() {\n        this._data.value = '';\n        this._quantidade.value = 1;\n        this._valor.value = 0.0;\n        this._data.focus();\n    }\n\n    ordena(coluna) {\n\n        if (this._ordemAtual == coluna) {\n            this._negociacoes.inverteOrdem();\n        } else {\n            this._negociacoes.ordena((p, s) => p[coluna] - s[coluna]);\n        }\n        this._ordemAtual = coluna;\n    }\n}\n\nlet negociacaoController = new NegociacaoController();\n\nexport function currentInstance() {\n    return negociacaoController;\n}"]}