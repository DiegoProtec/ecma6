{"version":3,"sources":["../../app-es6/services/NegociacaoService.js"],"names":["HttpService","ConnectionFactory","Negociacao","NegociacaoDao","NegociacaoService","_http","lista","self","Promise","resolve","reject","obterNegociacoes","then","negociacoes","filter","some","negociacao","isEquals","negociacaoExistente","catch","erro","get","connection","dao","adiciona","apaga","mensagem","map","Date","objeto","data","quantidade","valor","console","log","all","negociacoesSemana","negociacoesSemanaAnterior","negociacoesSemanaRetrasada","periodos","reduce","dados","periodo","concat","dado"],"mappings":"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","file":"NegociacaoService.js","sourcesContent":["import { HttpService } from './HttpService';\nimport { ConnectionFactory } from './ConnectionFactory';\nimport { Negociacao } from '../models/Negociacao';\nimport { NegociacaoDao } from '../daos/NegociacaoDao';\n\nexport class NegociacaoService {\n\n\tconstructor() {\n\t\tthis._http = new HttpService();\n\t}\n\n\timportar(lista) {\n\n\t\tlet self = this;\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tConnectionFactory\n\t\t\tself\n\t\t\t\t.obterNegociacoes()\n\t\t\t\t.then(negociacoes =>\n\t\t\t\t\tnegociacoes.filter(negociacao =>\n\t\t\t\t\t\t!lista.some(negociacaoExistente =>\n\t\t\t\t\t\t\tnegociacao.isEquals(negociacaoExistente)\n\t\t\t\t\t\t)\n\t\t\t\t\t)\n\t\t\t\t)\n\t\t\t\t.then(negociacoes => resolve(negociacoes))\n\t\t\t\t.catch(erro => reject(erro));\n\t\t});\n\n\t}\n\n\tcadastrar(negociacao) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tConnectionFactory\n\t\t\t\t.get()\n\t\t\t\t.then(connection => new NegociacaoDao(connection))\n\t\t\t\t.then(dao => dao.adiciona(negociacao))\n\t\t\t\t.then(() => resolve('Negociação cadastrada com sucesso.'))\n\t\t\t\t.catch(() => reject('Não foi possível cadastrar negociação.'));\n\t\t});\n\t}\n\n\tlistar() {\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tConnectionFactory\n\t\t\t\t.get()\n\t\t\t\t.then(connection => new NegociacaoDao(connection))\n\t\t\t\t.then(dao => dao.lista())\n\t\t\t\t.then(negociacoes => resolve(negociacoes))\n\t\t\t\t.catch('Não foi possível listar negociações.');\n\t\t});\n\t}\n\n\tapagar() {\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tConnectionFactory.get()\n\t\t\t\t.then(connection => new NegociacaoDao(connection))\n\t\t\t\t.then(dao => dao.apaga())\n\t\t\t\t.then(mensagem => resolve(mensagem))\n\t\t\t\t.catch(erro => reject(erro));\n\t\t});\n\t}\n\n\tnegociacoesSemana() {\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis._http\n\t\t\t\t.get('negociacoes/semana')\n\t\t\t\t.then(negociacoes => resolve(negociacoes.map(\n\t\t\t\t\tobjeto => new Negociacao(new Date(objeto.data), objeto.quantidade, objeto.valor))))\n\t\t\t\t.catch(erro => {\n\t\t\t\t\tconsole.log(erro);\n\t\t\t\t\treject('Não foi possível importar negociações da semana.');\n\t\t\t\t});\n\t\t});\n\t}\n\n\tnegociacoesSemanaAnterior() {\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis._http\n\t\t\t\t.get('negociacoes/anterior')\n\t\t\t\t.then(negociacoes => resolve(negociacoes.map(\n\t\t\t\t\tobjeto => new Negociacao(new Date(objeto.data), objeto.quantidade, objeto.valor))))\n\t\t\t\t.catch(erro => {\n\t\t\t\t\tconsole.log(erro);\n\t\t\t\t\treject('Não foi possível importar negociações da semana.');\n\t\t\t\t});\n\t\t});\n\t}\n\n\tnegociacoesSemanaRetrasada() {\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis._http\n\t\t\t\t.get('negociacoes/retrasada')\n\t\t\t\t.then(negociacoes => resolve(negociacoes.map(\n\t\t\t\t\tobjeto => new Negociacao(new Date(objeto.data), objeto.quantidade, objeto.valor))))\n\t\t\t\t.catch(erro => {\n\t\t\t\t\tconsole.log(erro);\n\t\t\t\t\treject('Não foi possível importar negociações da semana.');\n\t\t\t\t});\n\t\t});\n\t}\n\n\tobterNegociacoes() {\n\n\t\treturn new Promise((resolve, reject) => {\n\n\t\t\tPromise.all([\n\t\t\t\tthis.negociacoesSemana(),\n\t\t\t\tthis.negociacoesSemanaAnterior(),\n\t\t\t\tthis.negociacoesSemanaRetrasada()\n\t\t\t]).then(periodos => {\n\t\t\t\tlet negociacoes = periodos.reduce((dados, periodo) => dados.concat(periodo), [])\n\t\t\t\t\t.map(dado => new Negociacao(new Date(dado.data), dado.quantidade, dado.valor));\n\t\t\t\tresolve(negociacoes);\n\t\t\t}).catch(erro => reject(erro));\n\t\t});\n\t}\n}"]}